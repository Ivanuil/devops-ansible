Windows PowerShell
(C) Корпорация Майкрософт (Microsoft Corporation). Все права защищены.

Попробуйте новую кроссплатформенную оболочку PowerShell (https://aka.ms/pscore6)

PS C:\Users\ivo-p> cd .\Downloads\lr_ansible\
PS C:\Users\ivo-p\Downloads\lr_ansible> docker compose down; docker compose build; docker compose up -d; docker compose exec ansible /bin/sh
time="2024-12-14T19:59:38+03:00" level=warning msg="C:\\Users\\ivo-p\\Downloads\\lr_ansible\\docker-compose.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
[+] Running 4/4
 ✔ Container ansible                  Removed                                                                                                         10.4s
 ✔ Container lr_ansible-postgres-1    Removed                                                                                                          0.5s
 ✔ Container lr_ansible-clickhouse-1  Removed                                                                                                          1.2s
 ✔ Network lr_ansible_default         Removed                                                                                                          0.2s
time="2024-12-14T19:59:49+03:00" level=warning msg="C:\\Users\\ivo-p\\Downloads\\lr_ansible\\docker-compose.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
[+] Building 0.7s (10/10) FINISHED                                                                                                     docker:desktop-linux
 => [ansible internal] load build definition from dockerfile                                                                                           0.0s
 => => transferring dockerfile: 293B                                                                                                                   0.0s
 => [ansible internal] load metadata for docker.io/library/alpine:3.20.3                                                                               0.5s
 => [ansible internal] load .dockerignore                                                                                                              0.0s
 => => transferring context: 2B                                                                                                                        0.0s
 => [ansible 1/4] FROM docker.io/library/alpine:3.20.3@sha256:1e42bbe2508154c9126d48c2b8a75420c3544343bf86fd041fb7527e017a4b4a                         0.0s
 => [ansible internal] load build context                                                                                                              0.0s
 => => transferring context: 162B                                                                                                                      0.0s
 => CACHED [ansible 2/4] RUN apk add --no-cache openssh-client ansible sshpass curl git maven &&     ansible-galaxy collection install community.gene  0.0s
 => CACHED [ansible 3/4] COPY ./ansible /ansible                                                                                                       0.0s
 => CACHED [ansible 4/4] WORKDIR /ansible                                                                                                              0.0s
 => [ansible] exporting to image                                                                                                                       0.0s
 => => exporting layers                                                                                                                                0.0s
 => => writing image sha256:81d4b3902a26fd88a1f3f47f2eb3c3646c9afa92a334c9bde34ab95fd336581f                                                           0.0s
 => => naming to docker.io/library/lr_ansible-ansible                                                                                                  0.0s
 => [ansible] resolving provenance for metadata file                                                                                                   0.0s
time="2024-12-14T19:59:50+03:00" level=warning msg="C:\\Users\\ivo-p\\Downloads\\lr_ansible\\docker-compose.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
[+] Running 4/4
 ✔ Network lr_ansible_default         Created                                                                                                          0.0s
 ✔ Container lr_ansible-postgres-1    Started                                                                                                          1.1s
 ✔ Container ansible                  Started                                                                                                          1.1s
 ✔ Container lr_ansible-clickhouse-1  Started                                                                                                          1.0s
time="2024-12-14T19:59:52+03:00" level=warning msg="C:\\Users\\ivo-p\\Downloads\\lr_ansible\\docker-compose.yaml: the attribute `version` is obsolete, it will be ignored, please remove it to avoid potential confusion"
/ansible # ansible-playbook java-setup.yaml app-run.yaml
[WARNING]: No inventory was parsed, only implicit localhost is available
[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Java-setup] ******************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************
ok: [localhost]

TASK [Install Java] ****************************************************************************************************************************************
changed: [localhost]

TASK [Install OpenJDK] *************************************************************************************************************************************
skipping: [localhost]

TASK [download apache maven] *******************************************************************************************************************************
changed: [localhost]

TASK [untar maven] *****************************************************************************************************************************************
changed: [localhost]

TASK [add maven to PATH] ***********************************************************************************************************************************
changed: [localhost]

PLAY RECAP *************************************************************************************************************************************************
localhost                  : ok=5    changed=4    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0


PLAY [Run Java Applications] *******************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************
ok: [localhost]

TASK [Clone repo] ******************************************************************************************************************************************
changed: [localhost]

TASK [Put credentials] *************************************************************************************************************************************
changed: [localhost]

TASK [mvn run] *********************************************************************************************************************************************
changed: [localhost]

PLAY RECAP *************************************************************************************************************************************************
localhost                  : ok=9    changed=7    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0

/ansible # curl localhost:8080
curl: (7) Failed to connect to localhost port 8080 after 0 ms: Could not connect to server
/ansible # curl localhost:8080
{"statuses":[{"pageSize":1000,"refreshInterval":86400000,"participantBatchMaxSize":1000,"batchCurrentSize":102,"userListSizeInThisOrLastIteration":1000,"working":true},{"username":"fondaata","requestRate":3.03149673728741}]}/ansible #